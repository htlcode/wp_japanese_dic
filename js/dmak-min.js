!function(){"use strict";function t(t){var e,o,i,n,s=[];for(i=0;i<t.length;i++)for(n=0;n<t[i].length;n++)o=Raphael.getTotalLength(t[i][n].path),e={"char":i,length:o,duration:o*p.options.step*1e3,path:t[i][n].path,groups:t[i][n].groups,text:t[i][n].text,object:{path:null,text:null}},s.push(e);return s}function e(t){var e,o,i=[];for(o=0;t>o;o++)e=new Raphael(p.options.element,p.options.width+"px",p.options.height+"px"),e.setViewBox(p.options.viewBox.x,p.options.viewBox.y,p.options.viewBox.w,p.options.viewBox.h),e.canvas.setAttribute("class","dmak-svg"),i.push(e);return i.reverse()}function o(t){var e;for(e=0;e<t.length;e++)t[e].path("M"+p.options.viewBox.w/2+",0 L"+p.options.viewBox.w/2+","+p.options.viewBox.h).attr(p.options.grid.attr),t[e].path("M0,"+p.options.viewBox.h/2+" L"+p.options.viewBox.w+","+p.options.viewBox.h/2).attr(p.options.grid.attr)}function i(t,e){null!==t.object.text&&t.object.text.remove();var o=function(){t.object.path.remove(),t.object={path:null,text:null},e.shift()};p.options.stroke.animated.erasing?(t.object.path.node.style.stroke=p.options.stroke.attr.active,e.push(r(t,-1,o))):o()}function n(t,e,o){var i=function(){if(null!==e.object.path){var t=p.options.stroke.attr.stroke;"random"===p.options.stroke.attr.stroke&&(t=Raphael.getColor()),e.object.path.node.style.stroke=t,e.object.path.node.style.transition=e.object.path.node.style.WebkitTransition="stroke 400ms ease",o.shift()}};e.object.path=t.path(e.path),e.object.path.attr(p.options.stroke.attr),p.options.stroke.order.visible&&s(t,e),p.options.stroke.animated.drawing?r(e,1,i):i()}function s(t,e){e.object.text=t.text(e.text.x,e.text.y,e.text.value),e.object.text.attr(p.options.stroke.order.attr)}function r(t,e,o){return t.object.path.attr({stroke:p.options.stroke.attr.active}),t.object.path.node.style.transition=t.object.path.node.style.WebkitTransition="none",t.object.path.node.style.strokeDasharray=t.length+" "+t.length,t.object.path.node.style.strokeDashoffset=e>0?t.length:0,t.object.path.node.getBoundingClientRect(),t.object.path.node.style.transition=t.object.path.node.style.WebkitTransition="stroke-dashoffset "+t.duration+"ms ease",t.object.path.node.style.strokeDashoffset=e>0?"0":t.length,setTimeout(o,t.duration)}function a(t,e){var o,i=t;if(2!==arguments.length)throw new Error("Missing arguments in extend function");for(o in e)"object"==typeof i[o]?i[o]=a(i[o],e[o]):i.hasOwnProperty(o)&&(i[o]=e[o]);return i}var p=function(t,e){if(this.text=t,this.options=a(p.options,e),this.strokes=[],this.papers=[],this.pointer=0,this.timeouts={play:[],erasing:[],drawing:[]},this.options.loadCode){if(!this.options.skipLoad){var o=new DmakLoader(this.options.uri),i=this;o.loadByCode(t,function(t){i.prepare(t),i.options.loaded(i.kanjis),i.options.autoplay&&i.render()})}}else if(!this.options.skipLoad){var o=new DmakLoader(this.options.uri),i=this;o.load(t,function(t){i.prepare(t),i.options.loaded(i.kanjis),i.options.autoplay&&i.render()})}};p.VERSION="0.2.0",p.options={uri:"",loadCode:!1,skipLoad:!1,autoplay:!0,height:109,width:109,viewBox:{x:0,y:0,w:109,h:109},step:.03,element:"draw",stroke:{animated:{drawing:!0,erasing:!0},order:{visible:!1,attr:{"font-size":"8",fill:"#999999"}},attr:{active:"#BF0000",stroke:"#2C2C2C","stroke-width":4,"stroke-linecap":"round","stroke-linejoin":"round"}},grid:{show:!0,attr:{stroke:"#CCCCCC","stroke-width":.5,"stroke-dasharray":"--"}},loaded:function(){},erased:function(){},drew:function(){}},p.fn=p.prototype={prepare:function(i){this.kanjis=t(i),this.papers=e(i.length),this.options.grid.show&&o(this.papers)},erase:function(t){if(this.timeouts.play.length)return!1;if(this.pointer<=0)return!1;"undefined"==typeof t&&(t=0);do this.pointer--,i(this.kanjis[this.pointer],this.timeouts.erasing),this.options.erased(this.pointer);while(this.pointer>t)},render:function(t){if(this.timeouts.play.length)return!1;if("undefined"==typeof t)t=this.kanjis.length;else if(t>this.kanjis.length)return!1;var e,o=function(t){n(t.papers[t.kanjis[t.pointer]["char"]],t.kanjis[t.pointer],t.timeouts.drawing),t.options.drew(t.pointer),t.pointer++,t.timeouts.play.shift()},i=0;for(e=0;e<this.timeouts.erasing.length;e++)window.clearTimeout(this.timeouts.erasing[e]),this.timeouts.erasing=[];for(e=this.pointer;t>e;e++)!p.options.stroke.animated.drawing||0>=i?o(this):this.timeouts.play.push(setTimeout(o,i,this)),i+=this.kanjis[e].duration},pause:function(){for(var t=0;t<this.timeouts.play.length;t++)window.clearTimeout(this.timeouts.play[t]);this.timeouts.play=[]},eraseLastStrokes:function(t){this.erase(this.pointer-t)},renderNextStrokes:function(t){this.render(this.pointer+t)}},window.Dmak=p}(),function(){"use strict";function t(t,o,i,n){var s=new XMLHttpRequest,r=("00000"+i).slice(-5);return"00020"===r||"03000"===r?void n.done(o,{paths:[],texts:[]}):(s.open("GET",t+r+".svg",!0),s.onreadystatechange=function(){4===s.readyState&&(200===s.status?n.done(o,e(s.response,r)):n.error(s.statusText))},void s.send())}function e(t,e){function o(t){var e,i=t.childNodes;for(e=0;e<i.length;e++)"g"===i[e].tagName?(a.push(i[e].getAttribute("id")),o(i[e]),a.splice(a.indexOf(i[e].getAttribute("id")),1)):"path"===i[e].tagName&&n.push({path:i[e].getAttribute("d"),groups:a.slice(0)})}var i,n=[],s=(new DOMParser).parseFromString(t,"application/xml"),r=s.querySelectorAll("text"),a=[];for(o(s.getElementById("kvg:"+e)),i=0;i<r.length;i++)n[i].text={value:r[i].textContent,x:r[i].getAttribute("transform").split(" ")[4],y:r[i].getAttribute("transform").split(" ")[5].replace(")","")};return n}var o=function(t){this.uri=t};o.prototype.load=function(e,o){var i,n=[],s=e.length,r=0,a={done:function(t,e){console.log(t),console.log(e),n[t]=e,r++,r===s&&o(n)},error:function(t){console.log("Error",t)}};for(i=0;s>i;i++)t(this.uri,i,e.charCodeAt(i).toString(16),a)},o.prototype.loadByCode=function(t,o){var i=[],n=new XMLHttpRequest,s={done:function(t){i[0]=t,o(i)},error:function(t){console.log("Error",t)}};n.open("GET",this.uri+t+".svg",!0),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?s.done(e(n.response,t)):s.error(n.statusText))},n.send()},window.DmakLoader=o}();